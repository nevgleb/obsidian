
# Что такое SQLi

Внедрение SQL (SQLi) - это уязвимость в системе веб-безопасности, которая позволяет злоумышленнику вмешиваться в запросы, которые приложение выполняет к своей базе данных. Это может позволить злоумышленнику просматривать данные, которые они обычно не могут получить.

SQLi могут возникнуть в различных контекстах, таких как [[JSON]]  [[XML]]

## Как обнраужить

Обнаружить внедрение SQLi вручную, используя систематический набор тестов для каждой точки входа в приложении. Для этого обычно необходимо отправить:

- Заключите символ в одинарные кавычки `'` и ищите ошибки или другие аномалии.
- Некоторый специфичный для SQL синтаксис, который вычисляет базовое (исходное) значение точки входа и другое значение и ищет систематические различия в ответах приложения.
- Логические условия, такие как `OR 1=1` и `OR 1=2`, и поиск различий в ответах приложения.
- Полезные нагрузки, предназначенные для запуска временных задержек при выполнении SQL-запроса и поиска различий во времени, затрачиваемом на ответ.
- Полезные нагрузки [[OAST]], предназначенные для запуска внеполосного сетевого взаимодействия при выполнении в рамках SQL-запроса и мониторинга любых результирующих взаимодействий.

## SQL-инъекция в разные части запроса

Большинство уязвимостей при SQL-инъекции возникают в `WHERE` предложении `SELECT` запроса. Большинство опытных тестировщиков знакомы с этим типом SQL-инъекции.

Однако уязвимости при внедрении SQL могут возникать в любом месте запроса и в разных типах запросов. Некоторые другие распространенные места, где возникает внедрение SQL::

- В `UPDATE` операторах, внутри обновленных значений или в `WHERE` предложении.
- В `INSERT` операторах, внутри вставленных значений.
- В `SELECT` операторах, внутри имени таблицы или столбца.
- В `SELECT` операторах, внутри `ORDER BY` предложения.



> [!На заметку]
> Будьте осторожны при введении условия `OR 1=1` в SQL-запрос. Даже если это кажется безвредным в контексте, в который вы внедряете, приложения часто используют данные из одного запроса в нескольких разных запросах. Например, если ваше условие достигает оператора `UPDATE` or `DELETE`, это может привести к случайной потере данных.





## Проверка базы данных при атаках с использованием SQL-инъекций

Для использования уязвимостей SQL-инъекции часто необходимо найти информацию о базе данных. Это включает в себя:

- Тип и версия программного обеспечения для работы с базами данных.
- Таблицы и столбцы, содержащиеся в базе данных.

### Запрос типа и версии базы данных

Потенциально вы можете определить как тип, так и версию базы данных, введя запросы, зависящие от конкретного поставщика, чтобы проверить, работает ли один из них

Ниже приведены некоторые запросы для определения версии базы данных для некоторых популярных типов баз данных:

| Тип базы данных  | Запрос                    |
| ---------------- | ------------------------- |
| Microsoft, MySQL | `SELECT @@version`        |
| Oracle           | `SELECT * FROM v$version` |
| PostgreSQL       | `SELECT version()`        |
Например, вы могли бы использовать `UNION` атаку со следующими входными данными:

`' UNION SELECT @@version--`
### Перечисление содержимого базы данных

Большинство типов баз данных (кроме Oracle) имеют набор представлений, называемый информационной схемой. Это предоставляет информацию о базе данных.

Например, вы можете запросить `information_schema.tables` список таблиц в базе данных:

`SELECT * FROM information_schema.tables`

## SQL-инъекция второго порядка

SQL-инъекция первого порядка происходит, когда приложение обрабатывает вводимые пользователем данные из HTTP-запроса и включает входные данные в SQL-запрос небезопасным способом.

SQL-инъекция второго порядка происходит, когда приложение принимает вводимые пользователем данные из HTTP-запроса и сохраняет их для дальнейшего использования. Обычно это делается путем помещения входных данных в базу данных, но в точке, где хранятся данные, уязвимости не возникает. Позже, при обработке другого HTTP-запроса, приложение извлекает сохраненные данные и включает их в SQL-запрос небезопасным способом. По этой причине SQL-инъекция второго порядка также известна как хранимая SQL-инъекция.

Внедрение SQL второго порядка часто происходит в ситуациях, когда разработчики знают об уязвимостях SQL-инъекций и поэтому безопасно обрабатывают первоначальное размещение входных данных в базе данных. Когда данные обрабатываются позже, они считаются безопасными, поскольку ранее они были безопасно помещены в базу данных. На этом этапе данные обрабатываются небезопасным способом, поскольку разработчик ошибочно считает их надежными.

## Вид SQLi

Основные виды SQLi:
- [[SQL injection UNION attacks | Union SQLi]]
- [[Blind SQL injection | слепые SQLi]]
	- [[Blind SQL injection using OAST techniques | слепой SQL-инъекции с использованием внеполосных методов ]]
	- [[Time-based blind SQLi | cлепые SQLi на основе временных задержек]]
- [[Error-based SQL injection | SQLi на основе ошибок]]

